<?php

/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class Version96 extends Doctrine_Migration_Base {

  public function up() {
    $this->addColumn('petition', 'activity_at', 'timestamp', '25', array(
        'notnull' => '',
    ));
  }

  public function down() {
    $this->removeColumn('petition', 'activity_at');
  }

  public function postUp() {
    parent::postUp();

    $q = Doctrine_Manager::getInstance()->getCurrentConnection();
    $q->exec('UPDATE petition p SET p.activity_at = (SELECT created_at FROM petition_signing ps WHERE ps.petition_id = p.id ORDER BY ps.id DESC LIMIT 1)');
  }

}
